<style>
  /* Minimal additions on top of Pico defaults */
  .filter-bar {
    margin-bottom: 1rem;
  }

  .badge {
    display: inline-block;
    padding: .25em .55em;
    font-size: .65em;
    background: var(--pico-primary, #0b6efd);
    color: #fff;
    border-radius: 1rem;
    line-height: 1;
  }

  .user-key {
    font-size: .6rem;
    opacity: .6;
    word-break: break-all;
    padding-top: .25em;
  }

  .pill {
    display: inline-block;
    padding: .25em .7em;
    background: var(--pico-muted-border-color, rgba(127, 127, 127, .15));
    border-radius: 1rem;
    font-size: .7em;
  }

  .danger {
    color: var(--pico-del-color, #d9534f);
    border-color: var(--pico-del-color, #d9534f);
    cursor: pointer;
  }

  .empty-state {
    padding: 1rem;
    border: 2px dashed var(--pico-border-color, #ccc);
    border-radius: .6rem;
    text-align: center;
  }

  /* Softer animations */
  .htmx-added {
    animation: fadeInSoft 160ms ease-out, highlightSoft 900ms ease-out;
  }
  .htmx-swapping {
    animation: fadeOutSoft 140ms ease-in forwards;
    pointer-events:none;
  }
  @keyframes fadeInSoft {
    from { opacity:0; transform:translateY(2px); }
    to   { opacity:1; transform:translateY(0); }
  }
  @keyframes fadeOutSoft {
    from { opacity:1; transform:translateY(0); }
    to   { opacity:0; transform:translateY(-2px); }
  }
  @keyframes highlightSoft {
    0% { background:#fff8d9; }
    100% { background:transparent; }
  }
  @media (prefers-reduced-motion: reduce) {
    .htmx-added, .htmx-swapping { animation:none; }
  }

  .sync-report {
    margin-bottom: 1rem;
    padding: 1rem;
    background: var(--pico-card-background-color);
    border: 1px solid var(--pico-card-border-color);
    border-radius: var(--pico-border-radius);
  }
  .sync-report ul {
    margin-bottom: 0;
    padding-left: 1rem;
  }
</style>

{% if let Some(report) = sync_report %}
<div class="sync-report">
  <strong>Federated Sync Results:</strong>
  <ul>
    {% for result in report %}
    <li>
      {{ result.server_name }}:
      {% match result.status %}
        {% when crate::federated_users::SyncStatus::Created %}
          <span class="badge" style="background-color: #28a745;">Created</span>
        {% when crate::federated_users::SyncStatus::AlreadyExists %}
          <span class="badge" style="background-color: #ffc107; color: black;">Exists</span>
        {% when crate::federated_users::SyncStatus::Failed %}
          <span class="badge" style="background-color: #dc3545;">Failed</span>
        {% when crate::federated_users::SyncStatus::Skipped %}
          <span class="badge" style="background-color: #6c757d;">Skipped</span>
        {% when crate::federated_users::SyncStatus::Deleted %}
          <span class="badge" style="background-color: #dc3545;">Deleted</span>
        {% when crate::federated_users::SyncStatus::NotFound %}
          <span class="badge" style="background-color: #6c757d;">Not Found</span>
      {% endmatch %}
      {% if let Some(msg) = result.message %}
        <small>({{ msg }})</small>
      {% endif %}
    </li>
    {% endfor %}
  </ul>
</div>
{% endif %}

<div class="filter-bar">
  <input id="user-filter" type="search" placeholder="Filter users" oninput="filterUsers(this.value)">
</div>

{% if users.is_empty() %}
<div class="empty-state" role="note">
  <p>No users yet. Add one above to begin.</p>
</div>
{% else %}
<section class="user-list" aria-label="Users">
  {% for uwm in users %}
  {% include "user_item.html" %}
  {% endfor %}
</section>
{% endif %}

<script>
  function filterUsers(q) {
    q = q.toLowerCase().trim();
    for (const art of document.querySelectorAll('section.user-list > article')) {
      const name = art.dataset.username.toLowerCase();
      art.hidden = q && !name.includes(q);
    }
  }
</script>